:root {
  /* NEW — REQUIRED */
  --caret-width: 3px;
  --caret-color: #fefeffff;
  --cursor-blinking-speed: 500ms;
  --cursor-blinking: true;
  --editor-font-size: 14px; /* NOT 1rem — absolute units only */
  --zoom-level: 1;
  --gutter-bg-color: #232731;
  --gutter-border-color: #232731;
  --gutter-border-width: 1px;
  --bg-color: #232731;
  --border-color: #232731;
  --border-width: 0;
  --border-round: 0;
  --active-line-bg: rgba(88, 166, 255, 0.1);
  --shadow-box-color: #58a6ff;
}

@keyframes cm-cursor-blink {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0;
  }
}

/* Cursor Blinking Logic - GPU Optimized */
.cm-editor-container[data-cursor-blinking='true'] .cm-cursor {
  animation: cm-cursor-blink var(--cursor-blinking-speed, 500ms) step-end infinite !important;
}

/* Force Stop Blinking */
.cm-editor-container[data-cursor-blinking='false'] .cm-cursor,
.cm-editor-container[data-cursor-blinking='false'] .cm-cursor-primary,
.cm-editor-container[data-cursor-blinking='false'] .cm-cursor-secondary {
  animation: none !important;
  opacity: 1 !important;
  visibility: visible !important;
}
/* VS CODE STYLE: Active Line Background (Base) */
.cm-editor .cm-activeLine {
  background-color: var(--active-line-bg) !important;
}

/* VS CODE BEHAVIOR: Hide active line background and indicator when text is selected */
.cm-editor[data-has-selection='true'] .cm-activeLine {
  background-color: transparent !important;
  border-left-color: transparent !important;
  box-shadow: none !important;
}

/* 
.cm-editor-wrapper {
  --zoom-level: 1;
  transition: all 140ms cubic-bezier(0.4, 0, 0.2, 1);
  min-height: 100vh !important;
}

.cm-scroller {
  background-color: transparent !important;
  min-height: 100vh !important;
}

.cm-editor.cm-focused {
  outline: none !important;
}

.cm-editor {
  font-size: calc(var(--editor-font-size) * var(--zoom-level));
  background-color: var(--color-bg-primary, transparent) !important;
  min-width: 100% !important;
  min-height: 100% !important;
  line-height: 1.6 !important;
}

.cm-content {
  font-size: calc(var(--editor-font-size) * var(--zoom-level)) !important;
  line-height: 1.6 !important;
  min-height: 150vh !important;
  padding-bottom: 50vh !important;
}

.cm-gutters {
  background: var(--color-bg-secondary, transparent) !important;
  border-right: 1px solid var(--color-border, transparent) !important;
  font-family: inherit !important;
  font-size: inherit !important;
  line-height: 1.6 !important;
  min-width: calc(40px * var(--zoom-level, 1)) !important;
}

.cm-lineNumbers {
  padding-right: 8px !important;
  line-height: 1.6 !important;
} */

/* Layout Reset: Ensure no global CSS affects the editor internals */
.cm-content,
.cm-content *,
.cm-line,
.cm-line * {
  margin: 0 !important;
  padding: 0 !important;
  line-height: 1.6 !important;
  box-sizing: border-box !important;
}

/* Specific fix for the "huge space" caused by triple backticks */
.cm-content pre,
.cm-content code,
.cm-codeBlock {
  display: block !important;
  margin: 0 !important;
  padding: 0 !important;
  background: transparent !important;
  font-family: inherit !important;
  font-size: inherit !important;
}

/* Stabilize cursor rendering (GPU HARDWARE ACCELERATED) */
/* This is the VS Code 'secret sauce' - offloading cursor moves to the GPU */
.cm-cursor,
.cm-cursor-primary,
.cm-cursor-secondary {
  will-change: transform, opacity !important;
  transform: translateZ(0) !important; /* Move to GPU layer */
  backface-visibility: hidden !important;
  perspective: 1000 !important;
}

/* GPU Accelerated Active Line */
/* Sliding a 'sticker' is faster than redrawing pixels on every keystroke */
.cm-activeLine,
.cm-activeLineGutter {
  will-change: transform, background-color !important;
  transform: translateZ(0) !important;
  backface-visibility: hidden !important;
}

/* Smooth but stable scroller */
.cm-scroller {
  scroll-behavior: auto !important; /* Disable browser 'smooth scroll' which lags parser sync */
  will-change: scroll-position !important;
}
